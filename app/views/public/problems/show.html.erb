<div class="pb-5">
<div class="container pb-5">

  <!--悩み事の詳細画面-->
  <div class="row my-5">
    <div class="col-6">
      <h2 class="mark text-center rounded"><%= @problem.member.name %>さんの悩み事詳細</h2>
    </div>
  </div>

  <div class="row pl-5">
    <h5 class="col-3">タイトル</h5>
    <p class="col-3"><%= @problem.title %></p>
  </div>

  <div class="row pl-5">
    <h5 class="col-3">悩みの内容</h5>
    <p class="col-3"><%= @problem.body %></p>
  </div>

  <div class="row pl-5">
    <h5 class="col-3">カテゴリー</h5>
    <p class="col-3"><%= @problem.category.name %></p>
  </div>

  <!--自分の悩み事の投稿であれば、悩み事の削除リンクが表示-->
  <div class="row ml-2 pl-5">
    <% if @problem.member_id == current_member.id %>
      <%= link_to problem_path(@problem.id), method: :delete, "data-confirm" => "本当に削除しますか?", class:"offset-3 col-2 btn btn-danger" do %>
        <i class="fas fa-trash-alt"></i> 悩み事を削除
      <% end %>
    <% end %>
  </div>

  <!--他人の悩み事の投稿であれば、回答の投稿リンクが表示-->
  <div class="row ml-2 pl-5">
    <% if @problem.member_id != current_member.id %>
      <%= link_to new_problem_advice_path(@problem.id), class:"offset-3 col-2 btn btn-success" do %>
        <i class="fas fa-plus-circle"></i> 回答を投稿
      <% end %>
    <% end %>
  </div>

</div>

<div class="container pl-5 pb-5">
  <!--回答がある場合-->
    <% if @problem.advices.present? %>

    <% @problem.advices.each do |advice| %>

    <div class="row pt-3 pl-3 border-top border-secondary">
      <h4 class="col-4"><i class="far fa-comment-dots"></i> <%= advice.member.name %>さんからの回答</h4>
    </div>

    <div class="row pl-3">
      <p class="col-4"><%= advice.body %></p>
    </div>

    <!--回答に付けられた「いいね」に、ログインユーザーが含まれていれば削除-->
      <% if advice.favorited_by?(current_member) %>

      <div class="row pl-3">
        <%= link_to problem_advice_favorites_path(@problem, advice_id: advice.id), method: :delete, class:"col-4" do %>
          <span>いいねを外す</span>
        <% end %>
      </div>
      <div class="row pl-3">
        <p class="col-4"><%= advice.favorites.count %>人からいいねされています</p>
      </div>

      <!--回答に付けられた「いいね」に、ログインユーザーが含まれていなければ投稿-->
      <% else %>

      <div class="row pl-3">
        <%= link_to problem_advice_favorites_path(@problem, advice_id: advice.id), method: :post, class:"col-4" do %>
          <i class="far fa-thumbs-up"></i> いいね
        <% end %>
      </div>
      <div class="row pl-3">
        <p class="col-4"><%= advice.favorites.count %>人からいいねされています</p>
      </div>

      <% end %>

      <!--回答の投稿者であれば、回答の削除リンクが表示-->
      <div class="row pl-5">
      <% if advice.member_id == current_member.id %>
        <%= link_to problem_advice_path(advice.id), method: :delete, "data-confirm" => "本当に削除しますか?", class:"offset-3 col-2 btn btn-danger" do %>
          <i class="fas fa-trash-alt"></i> 回答を削除
        <% end %>
      <% end %>
      </div>

      <!--回答が存在、かつログインユーザーが悩み事の投稿者の場合、返事の投稿リンクが表示-->
      <div class="row pl-5">
      <% if @problem.member_id == current_member.id %>
        <%= link_to new_problem_advice_response_path(@problem, advice_id: advice.id), class:"offset-3 col-2 btn btn-success" do %>
          <i class="fas fa-plus-circle"></i> 返事を投稿
        <% end %>
      <% end %>
      </div>

      <!--返事がある場合-->
      <% if advice.responses.present? %>

        <% advice.responses.each do |response| %>

          <div class="row pt-3 pl-5">
            <h4 class="col-4"><i class="fas fa-reply fa-rotate-180"></i> <%= response.member.name %>さんからの返事</h4>
          </div>

          <div class="row pl-5">
            <p class="col-4"><%= response.body %></p>
          </div>

          <!--返事の投稿者であれば、返事の削除リンクが表示-->
          <div class="row pl-5">
          <% if response.member_id == current_member.id %>
            <%= link_to problem_advice_response_path(@problem, response.id), method: :delete, "data-confirm" => "本当に削除しますか?", class:"offset-3 col-2 btn btn-danger" do %>
              <i class="fas fa-trash-alt"></i> 返事を削除
            <% end %>
          <% end %>
          </div>

        <% end %>

      <!--返事が無い場合-->
      <% else %>

        <!--返事が無く回答がある場合-->
        <div class="row pt-3 pl-3">
        <% if @problem.advices.present? %>
          <h4 class="col-4">返事はまだありません。</h4>
        <% end %>
        </div>

      <% end %>

    <% end %>

    <!--回答が無い場合-->
    <% else %>

    <div class="row pt-3 pl-3">
      <h4 class="col-4">回答はまだありません。</h4>
    </div>

    <% end %>
  </div>
</div>
</div>